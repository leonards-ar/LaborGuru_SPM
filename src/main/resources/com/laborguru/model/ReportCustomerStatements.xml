<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ReportCustomerStatements">
	<select id="getActualSalesByCustomer" parameterClass="java.util.Map" resultClass="com.laborguru.model.HistoricSales"> 
	  SELECT r.region_id, 
    r.name, 
    SUM(hs.main_value) as main_value, 
    SUM(hs.second_value) as second_value, 
    SUM(hs.third_value) as third_value, 
    SUM(hs.fourth_value) as fourth_value  
    FROM tbl_regions r LEFT JOIN tbl_areas a ON r.region_id = a.area_id LEFT JOIN tbl_stores s ON a.area_id = s.area_id LEFT JOIN tbl_historic_sales hs ON s.store_id = hs.store_id AND DATE(hs.date_time) BETWEEN STR_TO_DATE(#start_date#, '%Y-%m-%d') AND STR_TO_DATE(#end_date#, '%Y-%m-%d') 
    WHERE r.customer_id=#customer_id# 
    GROUP BY r.region_id 
    ORDER BY r.region_id;
  </select>
  
  <select id="getActualHoursByCustomer" parameterClass="java.util.Map" resultClass="com.laborguru.model.report.TotalHour">
    SELECT
    r.region_id, r.name,
    sum(ah.hours) as schedule
    FROM tbl_regions r LEFT JOIN tbl_areas a ON r.region_id = a.region_id LEFT JOIN tbl_stores s ON a.area_id = s.area_id LEFT JOIN tbl_actual_hours ah ON s.store_id = ah.store_id AND ah.date BETWEEN STR_TO_DATE(#start_date#, '%Y-%m-%d') AND STR_TO_DATE(#end_date#, '%Y-%m-%d') 
    WHERE r.customer_id = #customer_id#
    GROUP BY r.region_id
    ORDER BY r.region_id
  </select>  
</sqlMap>
